# ソフトウェアの操作

**なぜターミナルでコマンドを実行するといろいろな動作が行われるのか*、その仕組みを紐解いていきます。

## OSの窓口役

ターミナルで実行されたコマンドを読み取ってくれる**シェル**について学びましょう。


### シェル

シェルは、簡単に言うと「**ターミナルとOSを繋ぐ窓口役**」のような存在です。
ターミナルから入力されたコマンドを読み取って、OSに対して指示を渡し、結果をターミナルに返して表示や実行などの動作をさせます。

これまでは、ターミナルがOSに指示を出しているように感じていたかもしれませんが、実際はこのシェルがターミナルとOSの間に挟まって、コマンドによる命令と実行結果の橋渡しをしています。

シェルにもさまざまな種類があり、それぞれプロンプトやコマンド実行後の出力で、表示と挙動が若干異なります。なかでも**zsh**は、`2019年にmacOSの標準シェル`となりました。

### zsh (ズィーシェル)

zshはシェルの1つです。
ターミナルで`echo $SHELL`とコマンドを実行すると現在使用しているシェルはzshであることがわかります。

2019年macOS Catalinaになる前の標準シェルであったbashと比較すると、コマンドを実行する際に大きな違いはありません。
わかりやすい違いとしては、bashのプロンプトは$なのに対し、zshのプロンプトは%である点です。

zshは、.から始まるドットファイルを作成・編集することで、設定を行うことができます。
環境構築では`、.zshrc`に設定を記述して、**PATH**にアプリケーションの場所を示すことでコマンドを使用可能にしました。

### PATH

PATHとは、「環境変数」と呼ばれるOS用の変数のことです。PATHには、複数の絶対パスの情報が保存されています。
コマンドが入力されたときに、シェルはPATHに記述されたパスのディレクトリ内のファイルを検索します。
つまり、PATHに絶対パスを保存してアプリケーションのありかを示せば、どこからコマンドを実行してもアプリケーションのコマンドを打つことができます。

PATHにアプリケーションのありかを示して、すべてのディレクトリからコマンドを使用可能にすることを、一般的に「PATHを通す」と表現します。

環境構築では、`.zshrc`にインストールした`rbenv`や`MySQL`のコマンドをすべてのディレクトリから使用できるようにPATHを通す作業を行なっています。

```ターミナル:PATHの例
# rbenvのパスを通す
% echo 'eval "$(rbenv init -)"' >> ~/.zshrc

# MySQLのパスを通す
% echo 'export PATH="/usr/local/opt/mysql@5.6/bin:$PATH"' >> ~/.zshrc
```

echoコマンドは、`>>`に続けてファイル名を指定することで、ファイルに文字を追加できるLinuxコマンドです。
`.zshrc`に`rbenv`の設定を反映するためのコマンドを記述することで、PATHを通しています。  

  
# コマンドとアプリケーションの関係

コマンドが実行されると、シェルがそれを読み取ってOSに指示を出します。

OSは指示を受けて、コマンドに合ったアプリケーションを動作させます。OSに初めから入っていてすぐに動作できるアプリケーションもあれば、そうでないアプリケーションもあります。

後からPCに追加する必要があり、よく利用されるアプリケーションは、**コマンドラインツール**としてまとめられています。

##  コマンドラインツール

コマンドで操作するアプリケーションのまとまりです。
コマンドラインツールを導入することで、OSが初めからコマンドで操作できるアプリケーション以外のアプリケーションをPCにインストールできます。

## Command Line Tools

macOS専用のコマンドラインツールのことです。
macOSでは、元々Linuxコマンドで操作できるアプリケーションや機能を標準搭載しています。
Linuxコマンド以外で操作するアプリケーションの多くはCommand Line Toolsのインストールによって、まとめてPCに導入できます。

![image](https://github.com/koharayuki/til/assets/132040884/428a6d90-6e78-43f2-a7ca-e2cde72cbc36)


たとえば、数々のソフトウェアをインストールする際に必要な「コンパイラ」と呼ばれるものもCommand Line Toolsに含まれます。
また、gitコマンドでGitを操作できたのは、Command Line Toolsをインストールしたからです（デフォルトで使用できる場合もあります）。

※Homebrewのインストールをし、brewコマンドによるHomebrewの操作を可能にするなど。  


# パッケージとバージョンの管理

複数のファイルやライブラリを扱う際、必ず知っておく必要がある依存関係について説明します。

##  依存関係

あるファイルやライブラリが正常に動作するために、別のファイルやライブラリによる処理と結果が必要になる状態を`依存`と呼び、依存している関係のことを`依存関係`と呼びます。

たとえば、ライブラリAがあり、ライブラリAの処理を利用して動作するライブラリBがあるとき、「AとBは依存関係にある」と言えます。

![image](https://github.com/koharayuki/til/assets/132040884/53359a33-a8a9-4f3c-a627-b049245988fa)

このときに、AまたはBのバージョンが更新されると、期待した動作が得られなくなる「依存関係の問題」が生じることがあります。
この問題は、いずれかのバージョンを上げすぎないようにすることや、一方の更新に伴ってもう一方のライブラリのバージョンも更新することで解決できます。

このような依存関係の管理を人が行おうとすると、ほぼ確実に問題が生じます。例にあげたものはライブラリ2つだけでしたが、実際はもっと大量のライブラリ同士が複雑に関わっています。
そのため、この問題を回避・解決するツールが用意されている場合がほとんどです。

