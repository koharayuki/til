# ブラウザが認識できる言語

## ブラウザの役割

ブラウザは、HTML, CSS, JavaScript, WebAssemblyという言語を認識して、画面にページを描画します。

※WebAssemblyについては難解であるため今後は触れませんが、処理の高速化が可能であることから、2019年にW3Cという団体によってWeb標準に認定された言語です。
ページを表示するためにHTML, CSS, JavaScript、テンプレートエンジンであるERBを用いて、HTMLにRubyを埋め込む作業も行っています。

![image](https://github.com/koharayuki/til/assets/132040884/f23a226d-e997-41e5-82ff-0dcbc56cd039)

しかしサーバーサイドでどれだけいろいろな言語を用いて書いたとしても、最終的には、HTML, CSS, JavaScriptとなってブラウザに返されています。
逆を言えば、最終的にこれらの言語へ変換されていなければブラウザはページを描画できません。

これは、ブラウザの認識できる言語が、これらのHTML, CSS, JavaScript, WebAssemblyのみであるためです。  


# 開発を便利にする言語

ブラウザは、HTML, CSS, JavaScript, WebAssemblyだけを認識してくれます。
しかし、多くの開発者は、開発するときにはもっと書きやすく、読みやすい言語で作りたいと考えます。

より開発者が開発しやすいよう設計されたプログラミング言語は、`高級言語`と呼ばれます。

##  高級言語

高級言語は、機械よりも人間が理解しやすいように設計されたプログラミング言語のことです。
反対に、機械が認識しやすい言語は低級言語と呼ばれます。

![image](https://github.com/koharayuki/til/assets/132040884/1a1ad9ab-f674-44e3-a41b-b83e50176150)

たとえば、開発者が効率よくCSSを書きたい場合は、より高級なSCSSやSASSなどの言語が使われます。
JavaScriptの場合も、`TypeScript`や`CoffeeScript`などの高級言語があり、保守性や効率を向上させた記法で開発することが多いです。

高級言語は便利なものですが、これらは、動作する機械が認識できるように、通常より多く翻訳してあげる必要があります。  


# ブラウザが認識できる言語に変換する仕組み

ブラウザが認識できる言語と、認識できない代わりに開発が便利になる言語があります。

高級言語で開発したあとに、それを機械が認識できる言語に翻訳する方法についての知識も必要となります。

## ブラウザが認識できる言語への変換

便利な書き方ができる言語で開発しても、結局はブラウザが認識できる形にする必要があります。

つまり、言語を別の言語に翻訳する必要があるということです。
このようなプログラミング言語における翻訳作業を`コンパイル`と呼びます。

## コンパイル

プログラミング言語を、動作する機械が理解できるように翻訳する作業のことです。

![image](https://github.com/koharayuki/til/assets/132040884/93fa48c2-7645-4635-8819-0307a9d9538c)

コンパイルは、コンパイラと呼ばれるプログラムによって行われます。
もしコンパイラで認識できない言語があれば、あらかじめ認識できる言語に`プリコンパイル`しておく必要があります。

## プリコンパイル

コンパイラが翻訳できない言語を翻訳できるようにする事前コンパイルのことです。あるいは、メインとなる処理に対して必要な前処理のことを指します。

![image](https://github.com/koharayuki/til/assets/132040884/b8696c0c-bdab-4c71-89fc-68b32838d5a4)

つまり、コンパイルやメインの処理の前に行われるべきコンパイルが、プリコンパイルです。

Webアプリケーションでは、Webブラウザが静的ファイルを読み込んで表示するというメインの処理ができるように、高級言語で書かれたファイルをプリコンパイルしてからブラウザに渡しています。

このようなプリコンパイルを行うための手法として、`アセットパイプライン`という仕組みがあります。

## アセットパイプライン

JavaScriptやCSSなどのアセットと呼ばれる静的ファイルを小さくまとめてくれる機能です。
アセットパイプラインには、高級言語のプリコンパイルを行う機能も追加できるため、これを応用してSCSSやTypeScriptなどを使用した開発もできるようになります。

アセットパイプラインの処理は、「プリコンパイル」「連結」「圧縮」「配置」の流れで行われます。

![image](https://github.com/koharayuki/til/assets/132040884/ffafc397-9459-4b87-baff-d7378a9848d4)

複数の静的ファイルをプリコンパイルして連結したのち、圧縮して軽量化したものをpublicディレクトリに配置して、ブラウザへ渡せるようにします。

これまでRailsでは、CSSやJavaScript等をプリコンパイルするために、SprocketsというGemによるアセットパイプラインをデフォルトで用いていました。

しかし、近年JavaScriptのライブラリ機能を合わせて開発することが多くなってきたため、Railsではバージョン6以降から、`モジュールバンドラ`を使用したプリコンパイルを主流とするようになりました。

##  モジュールバンドラ

モジュールバンドラは、JavaScriptのモジュールの依存関係を考慮しながら管理するツールです。

モジュールとは、機能を1つずつ分けて他のファイルから読み込めるようにした処理のまとまりのことです。
JavaScriptでは複数の機能をファイルごとに分割すると、1つのファイルへまとめる際に不具合が生じるため、Node.js環境では機能をモジュールという単位で扱います。

![image](https://github.com/koharayuki/til/assets/132040884/0064e72f-1be4-4d56-8321-07bda4212897)

モジュールによって、大量の機能を複数のファイルに分けることができ、分けられた機能を1つのファイルにまとめても問題なく動作できます。
ただし、複数に分かれるため依存関係が生まれ、読み込みができていないモジュールがあると正しく動作できない問題があります。

これを解消するのが、モジュールを一括で束ねて管理してくれるモジュールバンドラです。
近年では、モジュールバンドラの中でも`webpack`が主流となりつつあります。

## webpack

webpack公式ドキュメント　→ https://webpack.js.org/

webpackとは、Webアプリケーションを作成する際に必要な、さまざまなJavaScriptをひとまとめに管理するためのツールです。
モダンなWebアプリケーション開発では、さまざまなJavaScriptライブラリを用いるため、その依存関係を管理してくれます。

![image](https://github.com/koharayuki/til/assets/132040884/68ee6d7d-8d71-401c-a36d-37ce16f86cce)

