##  attributesメソッド

attributesメソッドはインスタンスメソッドから取得できる値をオブジェクト型からハッシュ型に変換できるメソッドです。
前提として、オブジェクト型とハッシュ型は以下のような値です。

```
# 例：Userインスタンスがもつオブジェクト型の値
#=><user:000000000>

# 例：Userインスタンスがもつハッシュ型の値
#=> {name=>"tanaka", :age=>"25", gender=>”women”}
```

このように、型によって取得できる値が異なります。インスタンスメソッドから値を取得する際に、オブジェクト型ではなくハッシュ型として値を取得したい場合には、attirbutesメソッドが有効です。

createアクションでは、attributesメソッドを用いて@userの値をオブジェクト型からハッシュ型に変換し、その値をuserのバリューとしてsessionに格納しています。

【app/controllers/users/registrations_controller.rb】
```ruby
 def create
   @user = User.new(sign_up_params)
    unless @user.valid?
      render :new and return
    end
   session["devise.regist_data"] = {user: @user.attributes}
  …

 end
```

【app/controllers/users/registrations_controller.rb】
```ruby
 def create
   @user = User.new(sign_up_params)
    unless @user.valid?
      render :new and return
    end
   session["devise.regist_data"] = {user: @user.attributes}
   …

 end
```

また、paramsの中にはパスワードの情報は含まれています。
しかし、attributesメソッドでデータ整形をした際にパスワードの情報は含まれていません。そこで、パスワードを再度sessionに代入する必要があります。

【app/controllers/users/registrations_controller.rb】
```ruby
session["devise.regist_data"] = {user: @user.attributes}
session["devise.regist_data"][:user]["password"]  = params[:user][:password]
```

### sessionの中身を確認する

値が取得できているかbinding.pryを入れて確かめます。
pry-railsというGemを導入後、以下の記述の様にbinding.pryを記述しまsう。

【app/controllers/users/registrations_controller.rb】
```ruby
session["devise.regist_data"] = {user: @user.attributes}
binding.pry
session["devise.regist_data"][:user]["password"]  = params[:user][:password]
binding.pry
```

session["devise.regist_data"] とコンソールに入力すると、以下のようにユーザーの情報がハッシュの中に入っていることが分かります。
上記確認後、「exit」と入力して処理を進めると、2つ目のbinding.pryにて処理が止まります。
そこでsession["devise.regist_data"][:user]["password"]とコンソールに入力すると、パスワード情報が確認できます。

※ 2つ目のbinding.pryにて止まった処理を「exit」にて再開させると、「Template is missing」のエラーが出ますが、これはまだ住所登録のビューを用意していなために出るエラーです。(正常な挙動)

![image](https://github.com/koharayuki/til/assets/132040884/07801cea-01af-4e9f-a737-e201daac37cb)

- 次の住所情報登録で使用するインスタンスを生成し、該当ページへ遷移すること

【app/controllers/users/registrations_controller.rb】
```ruby
@address = @user.build_address
render :new_address
```


