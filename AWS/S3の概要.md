# データ保管サービスの利用

Facebook等のWebアプリケーションでは、毎日たくさんのユーザーが写真や動画をアップロードしています。
そして、画像や動画などのデータはユーザーがいつでも見返すことができるように蓄積されます。
したがって、サービス側はその大量のデータを安全にそして長期的に保存しておく必要があります。
例えば現実世界でも、自宅に荷物が置けない場合は、トランクサービスなどを利用して荷物を別の場所に保管することがあるでしょう。
それと同様に、インターネットの世界でもオンライン上の倉庫のような仕組みを利用し、大量のデータを安全に長期的に保管しているのです。
このようなデータを保存するサービスのことを、**ストレージサービス**と言います。

## ストレージサービス

ストレージサービスとは、インターネット上でデータを保存する場所を提供するサービスのことです。

作成したアプリケーションはあくまで個人制作であり、大勢のユーザーに使用されることを想定していません。
したがって、大量の画像データが投稿されることはなく、ストレージサービスを利用する必要がないといえます。

## Renderを利用した際にストレージサービスが必要となる理由

Renderの仕様では、アップロードされた画像はデプロイしたアプリのpublicディレクトリに保存されていました。
しかし、ユーザーがアップロードした画像データは、データベースが停止またはリフレッシュされる度に、消えてしまう仕様になっています。
そこで、ストレージサービスを利用することで、画像を長期的に保存することができるようになります。

![image](https://github.com/koharayuki/til/assets/132040884/725b41dd-8291-40e8-a8fe-6850f11f2095)

## S3（Amazon Simple Storage Service）

S3とは、AWSが提供するサービスの一つです。

インターネット上にデータを保存する箱を借りられるサービスであるとイメージをすると良いでしょう。
S3を利用することで、画像を保存したり、保存してある画像を取得したりすることができます。

S3に保存されたデータは実在の施設に分散して保管されるため、ネットワーク障害に強い仕様になっています。
また、使用した分だけ課金されるシステムであるため、保存できるデータ容量やファイル数の上限がなく使用することができます。   
   
   
# S3導入の流れ

AWSのサイト上で以下を実施します。

- S3で画像の保存先を作成する
その後、アプリケーションのソースコード上で、以下画像の保存先をS3に設定する処理を記述します。

- <ローカル環境>S3に保存する処理を記述する
- <本番環境>S3に保存する処理を記述する

![image](https://github.com/koharayuki/til/assets/132040884/cee85595-a04f-4dc4-b5a2-cf7d6c2093ea)   
   
   
   
# セキュリティ対策をする理由

S3を利用する際に必要となるアクセスキーという秘密情報がGitHubで公開されてしまった場合、不正利用の被害を受ける危険性があるためです。

### ◎ AWS上でのセキュリティ対策

- 保存機能にアクセス制限を設定（バケットポリシー）

### ◎ GitHubでのソースコード管理におけるセキュリティ対策

- 秘密情報を変数に代入して使用（環境変数）
- 秘密情報を誤操作でコミットしないよう防止する機能（git-secrets）

