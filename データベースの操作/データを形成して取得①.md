# 事前準備

### データを準備する

この作業は、データが入ったテーブルの作成まで行います。
そして、今回SQLを使用するのは「ターミナル」ではなく「Sequel Pro」です。

###  ターミナルで以下のコマンドを実行する

```ターミナル（MySQL）
mysql> exit
```

次に、projectsディレクトリに移動し、「sql-curriculum」というアプリケーションをクローンします。

```ターミナル
# projectsディレクトリへ移動
% cd ~/projects

# sql-curriculumをクローン
% git clone https://github.com/we-b/sql-curriculum.git
```

クローンが完了したらそのアプリケーションのディレクトリへ移動します。

```ターミナル
# sql-curriculumディレクトリへ移動
% cd sql-curriculum
```

移動ができたら以下のコマンドを実行し、データベースとテーブルを作成しましょう。
テーブルが作成できれば、rails db:seedでデータを投入します。

```ターミナル
% bundle install
% yarn install
% rails db:create
% rails db:migrate
% rails db:seed #アプリケーション内にすでに用意されたデータを読み込むためのコマンドです。
```

以上でデータを用意する作業は完了です。次に、Sequel Proからデータベースを確認してみます。

## データベースを確認する

Sequel Proにlocalhostで接続し、"sql_curriculum_development"のデータベースを選択します。

![image](https://github.com/koharayuki/til/assets/132040884/f37ace48-64eb-4aab-9e5f-154178fb9a03)


最後に`"shifts"`テーブルを選択し、データがあることを確認できれば、正常にデータの投入が完了しています。


# データを確認する

※例として使用するデータベースでは、ユーザーがアルバイトなどのシフトを提出するという想定のもと、テーブルを作成しています。

データベースには"users"と"shifts"の2つのテーブルがあり、1人のuserは多くのshiftを持つという構造になっています。

それぞれのテーブルは以下のようなカラムを持っています。

`＜usersテーブル＞`
| カラム名	       | 内容              |
| -------------- | ---------------- |
| last_name      | 苗字              |
| first_name	   | 名前              |
| age            | 年齢              |
| prefecture     | 出身の都道府県      |

`＜shiftsテーブル＞`
| カラム名	       | 内容                          |
| -------------- | ----------------------------- |
| date           | シフトの日付                     |
| start_time	   | シフトの開始時間                  |
| user_id        | このシフトが属するユーザーのid       |

※シフトは1コマ2時間制であり、レコード1行が1コマを表しているという前提のため、finish_timeのようなカラムはないものとします。


# Sequel ProでSQLを使用する

SQL文を実行する場所をSequel Proへ変更します。
実際にSequel Proを開いて、SQL文を実行する場所を確認します。

以下の画像のようにSequel Proの、`sql_curriculum_development`データベースを選択した状態で、「クエリ」と書かれたタブを押してください。

![image](https://github.com/koharayuki/til/assets/132040884/4c1c66eb-d45a-40f4-8212-f567f7e81a89)

## Sequel Proで以下のSQL文を実行する

Sequel Proで以下を実行しましょう。この時、一行ずつ実行するのではなく、全行を「クエリ」に記述した後に実行します。

```SequelPro（クエリ）
SELECT *
FROM users
```

なお、SQL文を実行するときは以下の画像のように、上画面へSQL文を記述し、"現在を実行"を押します。

![image](https://github.com/koharayuki/til/assets/132040884/1ee3dcf2-de2e-44cc-a4c5-a04873e776a9)

以下の画像のように結果が画面下部に表示されれば、正常にSQL文が実行されています。

![image](https://github.com/koharayuki/til/assets/132040884/544d5dd2-9397-482d-bbb1-cb5213163fa5)

また、ターミナルからではなくSequel ProからSQL文を実行するメリットについては、以下のようなものが挙げられます。

- 検索は長いSQL文を要するが、タイプミスをしたときにその部分だけを直せば再実行ができる
- 検索は場合によって非常に多くの出力を伴うが、実行したSQL文が流れてしまうことがないため見やすい
- SQL文の文末にセミコロン;を付ける必要がない


# データを検索する

条件にあったデータを取得します。

## WHERE句

`WHERE`句は、取得するデータを「条件」によって制限できる句です。
`WHERE`句では取得するレコードの条件を指定し、その条件が正のレコードを取得します。

```SequelPro（クエリ）:WHEREで条件にあったレコードを取得
WHERE 《条件》
```

`WHERE`句の条件には、以下のように"="や"<="のような比較演算子を使用できます。

また、内容が文字列や日付の場合はダブルクォーテーション"で文字を囲う必要があります。









