# Webサービスの設計思想

Webは誕生から20年で爆発的に普及し、巨大なサービスへと成長しました。
私たちが作る個々のWebサービスがここまで成功した要因は、設計思想とその構造にあります。

## アーキテクチャ

アーキテクチャとは、Webサービスや設計を形作る「構造」のことです。

Webを例にすると、Webはブラウザ、HTTP、HTMLなどで構成されているため、これらがWebのアーキテクチャということになります。
他の例としては、ECサイトは顧客が検索ワードを元にサイトに訪れた時、欲しそうな商品をページの横にも表示して購買意欲を促すといった構成になっています。
これらの「検索システム」「レコメンドシステム」がアーキテクチャに該当するものです。  
  
  
# システムの設計指針

実際のWebサービスは具体的なアーキテクチャを持っています。

## アーキテクチャスタイル

アーキテクチャスタイルとは、アーキテクチャを決める際の「設計指針」となるものです。

アーキテクチャを設計する時に、手当り次第に設計していくのではなく、指針やルールに沿って実装していきます。
指針に沿ったWebサービスは、無駄なアーキテクチャがなく整理されており、ユーザーが使いやすいように設計されています。

例として、「クライアント/サーバー」、「MVCモデル」、「オブジェクト指向」の考え方もアーキテクチャスタイルに含まれます。

![image](https://github.com/koharayuki/til/assets/132040884/67011cdd-ee8e-4fed-a173-d4bbeafb3b45)

### アーキテクチャとアーキテクチャスタイルの違い

「構造」と「設計指針」という点で異なります。アーキテクチャは、アーキテクチャスタイルの設計指針に基づいて、組み合わせていくものです。

| （例）Webを実装する時                                             |
| ------------------------------------------------------------ |
| Webのアーキテクチャスタイルの1つに、どのHTTPメソッド（GET, POST, PUT, DELETE）で、通信を行うかを定めたものがあります。<br>この指針に基づいて、ブラウザ、HTML、URLなどのアーキテクチャを組み合わせます。     |

| （例）家を建築する時                                             |
| ------------------------------------------------------------ |
| アーキテクチャスタイルは、どのような家にするのか方針を定めるものです。アーキテクチャは、アーキテクチャスタイルの方針に基づいた、トイレ、キッチン、玄関、リビングなど、家の構成1つ1つを指します。|

無数にあるアーキテクチャを選択する指針として、アーキテクチャスタイルが生まれました。
そして、Webサービスを設計するためのアーキテクチャスタイルも多く誕生し、いまではRESTという洗練されたアーキテクチャスタイルがよく起用されています。

## REST（Representational State Transfer）

`REST`はWebのアーキテクチャスタイルのことです。

Webのアーキテクチャスタイルとして一番有名なのが「クライアント/サーバー」です。
RESTは、クライアント/サーバーから派生したもので、これにいくつかの構成を加えることで`REST`というアーキテクチャスタイルが成立します。

## リソース

リソースとはRESTに関連する言葉で、「Web上で名前を持ったあらゆる情報」のことです。RESTでは、情報を「`リソース`」という考え方で表現するからです。

RESTの構成に入る前に、まずリソースについて触れてみます。

Web上のリソースを例に見てみましょう。

`【リソースの例】`

- 渋谷の天気予報情報
- 渋谷駅の写真データ
- 保存したブックマーク
- 
上記はいずれもリソースです。Web上には、数えきれないほどのリソースが存在します。

リソースがどこにあるかを指し示すものが`URL`になります。

| 名前               | URL                                                     |
| ------------------ | ------------------------------------------------------ |
| 渋谷の天気予報	     | https://weather.yahoo.co.jp                            |
| 渋谷駅の写真		     | https://www.flickr.com/search/?text=shibuyaeki         |
| 保存したブックマーク		 | https://railsguides.jp                                 |

このように、特定の写真、のような1つのものを「リソース」と呼んだり、Webページそのものをリソースと呼んだりします。

まとめると、

- リソースとは、Web上のあらゆる情報のこと
- 無数のリソースは、URLで場所を特定できる
- URLを用いることで、リソースの閲覧などができる

となります。

RESTは、クライアントとサーバーの間で実際にリソースをやり取りするとき、クライアントからURLにHTTPメソッド(GET,POST,PUT,DELETE)を加えた情報でリクエストします。

![image](https://github.com/koharayuki/til/assets/132040884/fa621955-1cfe-4e8e-9171-d59187ecc693)

また、1つのリソースは複数の情報を持っている可能性もあり、変化もします。
例えば、渋谷の天気予報のリソースは、テキストでも画像でも表現できます。
現在の予報が「晴れ」であったとしても、数時間後には「雨」に変化していることもあります。

## RESTの中身

RESTは複数のアーキテクチャスタイルが集まってできており、「クライアント/サーバー」を合わせた6つのアーキテクチャスタイルで成り立っています。

「クライアント/サーバー」は一言でいうと、クライアント側とサーバー側で処理を分ける仕組みのことです。

## ステートレスサーバー

ステートレスサーバーとは、クライアントの状態を保持しないサーバーのことです。
ステートレスとは、「状態がない」ということを意味します。
サーバー側で状態を管理しない為、クライアントはリクエストごとに全ての情報を送信します。
メリットは、サーバー側の実装が簡単になることです。

![image](https://github.com/koharayuki/til/assets/132040884/db2d8ffe-8b1c-487f-a78a-fd2d4064a2ba)

## キャッシュ

キャッシュとは、一度得たリソースをクライアント側で保存しそれを使い回す仕組みのことです。
メリットは、クライアントとサーバー間の通信を減らすことで処理時間の短縮と効率化に繋がります。
デメリットは、古いキャッシュを利用することで情報の信頼度が下がることがある点です。
例えば、CSSなどはキャッシュの仕組みで使い回されることがありますが、元のCSSは更新されているのにページの見た目が変わらない、ということが起こります。
キャッシュで使い回しているCSSは古いままのためです。

![image](https://github.com/koharayuki/til/assets/132040884/843be34d-4a1a-49ad-b6d1-e872bebe9d0b)

## 統一インターフェース

統一インターフェースとは、使用するメソッドを固定することです。RESTの中で最も特徴的なアーキテクチャスタイルです。
例えばHTTPメソッドでは、URLで指し示したリソースをGETやPOSTなどに限定することで、全体がシンプルになります。

![image](https://github.com/koharayuki/til/assets/132040884/2aba786f-17c2-412f-803c-78b27b66861d)

## 階層化システム

階層化システムとは、システムを階層に分けることです。
これは統一インターフェースにより受けられる恩恵になります。
クライアントとサーバーの間に階層を分割するものを設け、負担を分散したりします。

![image](https://github.com/koharayuki/til/assets/132040884/a21342fc-4d34-42b6-9ea9-2f6d524f6098)

## コードオンデマンド

コードオンデマンドとは、プログラムをクライアント側で実行することです。JavaScriptがこれに当たります。
メリットは、クライアントは後から新しい機能を追加していけます。
デメリットは、クライアント側での実行が増えるので、サーバーとやり取りされるリソースの内容が明確ではなくなります。

![image](https://github.com/koharayuki/til/assets/132040884/1e003ca9-6f3d-4433-8bc0-5d7fb9649fa2)

RESTに従って実装すると、全体としてより良いWebサービスになります。

ただし、RESTを構成するアーキテクチャスタイルのうちいくつかを除外しても問題ありませんし、実装により適した別のアーキテクチャスタイルがあれば無理にRESTを使う必要もありません。

Webサービスの設計においては、指針を決めつつも臨機応変に対応し、ユーザーに価値を提供できるサービスを作ることが重要になります。

