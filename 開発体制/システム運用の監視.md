# サービスの安定を保つ監視

サービスを運用する際に、安定を保つことはもっとも大事だといっても過言ではありません。
サービスをリリースしたとしても、バグ等を起こしていてはユーザーが定着することは無いためです。
しかし、1つのサービスを安定させるために人の力で監視するのは膨大な労力がかかる上、ミスも起こります。こうした問題を解決するために用いるのが`監視システム`です。

## 監視システム

運用しているサービスの監視を行い、異常が検知された場合は、運用担当者に通知をするシステムのことです。

## 監視の種類

監視と一言で言っても、何を監視するかによってその手法が分かれます。以下3つの監視の種類を取り上げていきます。

- サービスが「正常に動くこと」を確認する監視
- 障害の「予防」のための監視
- 発生した障害の「原因特定」のための監視


# サービスが「正常に動くこと」を確認する監視    


サービスにおいて最も大事なことは、「ユーザーへサービスを提供し続けること」です。
「ユーザーへサービスを提供し続ける」とは、「常に、正常にサービスへアクセスが可能であり、且つ正常にサービスが利用できること」を意味します。

これが達成できているかを定期的にチェックし、問題があれば報告があるようにしなければなりません。
そのために、サービス（Webサイト）が正常に利用できるかを定期的にチェックするWebシナリオ監視を行います。

## Webシナリオ監視

実際に運用しているサービス（Webサイト）にアクセスし、問題なく想定通りの結果が得られるかを監視する手法です。結合テストを、本番環境においても運用するようなイメージです。

以下の図のように、ユーザーが行う一連の操作を定期的に自動で再現し、それが正常に完了するかをチェックします。

![image](https://github.com/koharayuki/til/assets/132040884/970e34c7-2841-4baa-8b8f-3a495c38c16d)

## 予防のための監視

サービス継続のためには、障害の前兆を検知することも重要です。そのために、サーバーの処理能力が限界に近づいたり、アクセス不能になったりした場合、メールやSlackといった連絡手段で通知を送ります。

例えば下図のように、Webサーバーがサーバー1とサーバー2で分離されているとします。この場合、サーバー1に何らかの問題が生じると、サーバー2に負担がかかることになり致命的な障害の危険性が増します。
したがって、1つのサーバーに問題が生じたことを検知することは障害の予防になります。

「いつサービスが停止してもおかしくない状態」を迅速に検知することが「予防のための監視」です。

このように運用システムの裏側を監視し続けることを、`インフラ監視`と言います。

## インフラ監視

アプリケーションそのものではなく、そのアプリケーションを動かすサーバーなどのシステムを監視することを意味します。

![image](https://github.com/koharayuki/til/assets/132040884/7fe21ad5-3fa4-4ede-a4da-315d2337b363)

## 発生した障害の「原因特定」のための監視


システムは常に多くの小さなシステムの連携で動いています。その各システムと、システム間の繋がりがうまく行っているかを監視する必要もあります。これもインフラ監視の一つです。

特定の箇所だけを監視しているだけでは、障害が発生したことは確認できても、どこで障害が発生したかを検知することはできません。
下図のようにそれぞれのインフラの繋がりも監視することで、障害が発生した時も速やかに原因を特定し、復旧までの道筋を立てられるようになります。

![image](https://github.com/koharayuki/til/assets/132040884/99aa8129-8033-44f1-afe4-2dcbe4a3525d)

監視システムとは何か、なぜ監視システムが必要なのかの概要を理解することが重要です。

